/*! maska v3.1.0 by Alexander Shabunevich | Released under the MIT license */
(function(c,l){typeof exports=="object"&&typeof module<"u"?l(exports):typeof define=="function"&&define.amd?define(["exports"],l):(c=typeof globalThis<"u"?globalThis:c||self,l(c.Maska={}))})(this,function(c){"use strict";var j=Object.defineProperty;var x=(c,l,b)=>l in c?j(c,l,{enumerable:!0,configurable:!0,writable:!0,value:b}):c[l]=b;var A=(c,l,b)=>x(c,typeof l!="symbol"?l+"":l,b);const l={"#":{pattern:/[0-9]/},"@":{pattern:/[a-zA-Z]/},"*":{pattern:/[a-zA-Z0-9]/}},b=(n,e,t)=>n.replaceAll(e,"").replace(t,".").replace("..",".").replace(/[^.\d]/g,""),w=(n,e,t)=>{var s;return new Intl.NumberFormat(((s=t.number)==null?void 0:s.locale)??"en",{minimumFractionDigits:n,maximumFractionDigits:e,roundingMode:"trunc"})},P=(n,e=!0,t)=>{var E,N,M,g;const s=((E=t.number)==null?void 0:E.unsigned)!==!0&&n.startsWith("-")?"-":"",a=((N=t.number)==null?void 0:N.fraction)??0;let r=w(0,a,t);const p=r.formatToParts(1000.12),m=((M=p.find(o=>o.type==="group"))==null?void 0:M.value)??" ",k=((g=p.find(o=>o.type==="decimal"))==null?void 0:g.value)??".",i=b(n,m,k);if(Number.isNaN(parseFloat(i)))return s;const f=i.split(".");if(f[1]!=null&&f[1].length>=1){const o=f[1].length<=a?f[1].length:a;r=w(o,a,t)}let h=r.format(parseFloat(i));return e?a>0&&i.endsWith(".")&&!i.slice(0,-1).includes(".")&&(h+=k):h=b(h,m,k),s+h};class I{constructor(e={}){A(this,"opts",{});A(this,"memo",new Map);const t={...e};if(t.tokens!=null){t.tokens=t.tokensReplace?{...t.tokens}:{...l,...t.tokens};for(const s of Object.values(t.tokens))typeof s.pattern=="string"&&(s.pattern=new RegExp(s.pattern))}else t.tokens=l;Array.isArray(t.mask)&&(t.mask.length>1?t.mask=[...t.mask].sort((s,a)=>s.length-a.length):t.mask=t.mask[0]??""),t.mask===""&&(t.mask=null),this.opts=t}masked(e){return this.process(String(e),this.findMask(String(e)))}unmasked(e){return this.process(String(e),this.findMask(String(e)),!1)}isEager(){return this.opts.eager===!0}isReversed(){return this.opts.reversed===!0}completed(e){const t=this.findMask(String(e));if(this.opts.mask==null||t==null)return!1;const s=this.process(String(e),t).length;return typeof this.opts.mask=="string"?s>=this.opts.mask.length:s>=t.length}findMask(e){const t=this.opts.mask;if(t==null)return null;if(typeof t=="string")return t;if(typeof t=="function")return t(e);const s=this.process(e,t.slice(-1).pop()??"",!1);return t.find(a=>this.process(e,a,!1).length>=s.length)??""}escapeMask(e){const t=[],s=[];return e.split("").forEach((a,r)=>{a==="!"&&e[r-1]!=="!"?s.push(r-s.length):t.push(a)}),{mask:t.join(""),escaped:s}}process(e,t,s=!0){if(this.opts.number!=null)return P(e,s,this.opts);if(t==null)return e;const a=`v=${e},mr=${t},m=${s?1:0}`;if(this.memo.has(a))return this.memo.get(a);const{mask:r,escaped:p}=this.escapeMask(t),m=[],k=this.opts.tokens!=null?this.opts.tokens:{},i=this.isReversed()?-1:1,f=this.isReversed()?"unshift":"push",h=this.isReversed()?0:r.length-1,E=this.isReversed()?()=>o>-1&&u>-1:()=>o<r.length&&u<e.length,N=y=>!this.isReversed()&&y<=h||this.isReversed()&&y>=h;let M,g=-1,o=this.isReversed()?r.length-1:0,u=this.isReversed()?e.length-1:0,C=!1;for(;E();){const y=r.charAt(o),d=k[y],R=(d==null?void 0:d.transform)!=null?d.transform(e.charAt(u)):e.charAt(u);if(!p.includes(o)&&d!=null?(R.match(d.pattern)!=null?(m[f](R),d.repeated?(g===-1?g=o:o===h&&o!==g&&(o=g-i),h===g&&(o-=i)):d.multiple&&(C=!0,o-=i),o+=i):d.multiple?C&&(o+=i,u-=i,C=!1):R===M?M=void 0:d.optional&&(o+=i,u-=i),u+=i):(s&&!this.isEager()&&m[f](y),R===y&&!this.isEager()?u+=i:M=y,this.isEager()||(o+=i)),this.isEager())for(;N(o)&&(k[r.charAt(o)]==null||p.includes(o));){if(s){if(m[f](r.charAt(o)),e.charAt(u)===r.charAt(o)){o+=i,u+=i;continue}}else r.charAt(o)===e.charAt(u)&&(u+=i);o+=i}}return this.memo.set(a,m.join("")),this.memo.get(a)}}const S=n=>JSON.parse(n.replaceAll("'",'"')),T=(n,e={})=>{const t={...e};n.dataset.maska!=null&&n.dataset.maska!==""&&(t.mask=F(n.dataset.maska)),n.dataset.maskaEager!=null&&(t.eager=v(n.dataset.maskaEager)),n.dataset.maskaReversed!=null&&(t.reversed=v(n.dataset.maskaReversed)),n.dataset.maskaTokensReplace!=null&&(t.tokensReplace=v(n.dataset.maskaTokensReplace)),n.dataset.maskaTokens!=null&&(t.tokens=O(n.dataset.maskaTokens));const s={};return n.dataset.maskaNumberLocale!=null&&(s.locale=n.dataset.maskaNumberLocale),n.dataset.maskaNumberFraction!=null&&(s.fraction=parseInt(n.dataset.maskaNumberFraction)),n.dataset.maskaNumberUnsigned!=null&&(s.unsigned=v(n.dataset.maskaNumberUnsigned)),(n.dataset.maskaNumber!=null||Object.values(s).length>0)&&(t.number=s),t},v=n=>n!==""?!!JSON.parse(n):!0,F=n=>n.startsWith("[")&&n.endsWith("]")?S(n):n,O=n=>{if(n.startsWith("{")&&n.endsWith("}"))return S(n);const e={};return n.split("|").forEach(t=>{const s=t.split(":");e[s[0]]={pattern:new RegExp(s[1]),optional:s[2]==="optional",multiple:s[2]==="multiple",repeated:s[2]==="repeated"}}),e};class W{constructor(e,t={}){A(this,"items",new Map);A(this,"eventAbortController");A(this,"onInput",e=>{if(e instanceof CustomEvent&&e.type==="input"&&!e.isTrusted&&!e.bubbles)return;const t=e.target,s=this.items.get(t),a="inputType"in e&&e.inputType.startsWith("delete"),r=s.isEager(),p=a&&r&&s.unmasked(t.value)===""?"":t.value;this.fixCursor(t,a,()=>this.setValue(t,p))});this.options=t,this.eventAbortController=new AbortController,this.init(this.getInputs(e))}update(e={}){this.options={...e},this.init(Array.from(this.items.keys()))}updateValue(e){e.value!==""&&e.value!==this.processInput(e).masked&&this.setValue(e,e.value)}destroy(){this.eventAbortController.abort(),this.items.clear()}init(e){const t=this.getOptions(this.options);for(const s of e){if(!this.items.has(s)){const{signal:r}=this.eventAbortController;s.addEventListener("input",this.onInput,{capture:!0,signal:r})}const a=new I(T(s,t));this.items.set(s,a),queueMicrotask(()=>this.updateValue(s)),s.selectionStart===null&&a.isEager()&&console.warn("Maska: input of `%s` type is not supported",s.type)}}getInputs(e){return typeof e=="string"?Array.from(document.querySelectorAll(e)):"length"in e?Array.from(e):[e]}getOptions(e){const{onMaska:t,preProcess:s,postProcess:a,...r}=e;return r}fixCursor(e,t,s){const a=e.selectionStart,r=e.value;if(s(),a===null||a===r.length&&!t)return;const p=e.value,m=r.slice(0,a),k=p.slice(0,a),i=this.processInput(e,m).unmasked,f=this.processInput(e,k).unmasked;let h=a;m!==k&&(h+=t?p.length-r.length:i.length-f.length),e.setSelectionRange(h,h)}setValue(e,t){const s=this.processInput(e,t);e.value=s.masked,this.options.onMaska!=null&&(Array.isArray(this.options.onMaska)?this.options.onMaska.forEach(a=>a(s)):this.options.onMaska(s)),e.dispatchEvent(new CustomEvent("maska",{detail:s})),e.dispatchEvent(new CustomEvent("input",{detail:s.masked}))}processInput(e,t){const s=this.items.get(e);let a=t??e.value;this.options.preProcess!=null&&(a=this.options.preProcess(a));let r=s.masked(a);return this.options.postProcess!=null&&(r=this.options.postProcess(r)),{masked:r,unmasked:s.unmasked(a),completed:s.completed(a)}}}c.Mask=I,c.MaskInput=W,c.tokens=l,Object.defineProperty(c,Symbol.toStringTag,{value:"Module"})});
